(function(g,b){var h=g.fn.pista=function(l,i,k){if(b.createElement("canvas").getContext){this.each(function(){opts=g.extend(true,{},h.defaults,i);h.graphers.call(this,l,opts,k)})}return this};var d={getTime:function(i){return new Date(i).getTime()},tooltipEvent:function(){return"mousemove"},createCanvas:function(m,i){var k=b.createElement("canvas");k.setAttribute("width",m*a);k.setAttribute("height",i*a);if(a!=1){var l="width:"+m+"px;height:"+i+"px";k.setAttribute("style",l)}return k},getYValues:function(p,k,m){var q={};for(var n=0;n<p.length;n++){var o=p[n].data;for(var l=0;l<o.length;l++){e=o[l].value;if(n==0&l==0){q.min=q.max=e}else{q.min=Math.min(q.min,e);q.max=Math.max(q.max,e)}}}if(k.max){q.max=k.max}if(k.min){q.min=k.min}if(m.show){q.max=Math.max(q.max,m.value);q.min=Math.min(q.min,m.value)}q.marginMin=q.min-q.min*k.margin;q.marginMax=q.max+q.max*k.margin;q.margin=(q.marginMax-q.marginMin)*k.margin;f("margin",q.margin);return q},getXValues:function(o,l){var k={};for(var m=0;m<o.length;m++){var n=o[m].data;if(m==0){k.max=d.getTime(n[n.length-1].date);k.min=d.getTime(n[0].date)}else{k.max=Math.max(k.max,d.getTime(n[n.length-1].date));k.min=Math.min(k.min,d.getTime(n[0].date))}}if(l.max){k.max=d.getTime(l.max)}if(l.min){k.min=d.getTime(l.min)}k.margin=l.margin;return k},line:function(l,n,i,m){if(m){var k={x:(n.x+i.x)/2,y:(n.y+i.y)/2};l.quadraticCurveTo((n.x+k.x)/2,n.y,k.x,k.y);l.quadraticCurveTo((k.x+i.x)/2,i.y,i.x,i.y)}else{l.lineTo(i.x,i.y)}},fDate:function(i){return i.getMonth()+1+"/"+i.getDate()},deltaDays:function(l,i){var k=24*60*60*1000;return Math.round(Math.abs((l-i)/(k)))}};mainColor="#3BAFD7";secondaryColor="#E1523D";h.defaults={height:100,width:100,x:{margin:15,min:null,max:null},y:{margin:0.2,min:null,max:null},goal:{show:true,value:23,color:mainColor},tooltip:{show:true,maxRadius:3},lines:{show:true,fill:true,curve:true,strokeColor:[mainColor,secondaryColor],strokeWidth:4,fillOpacity:0.7,fillColor:[mainColor,secondaryColor]},points:{show:true,strokeWidth:3.5,strokeColor:[mainColor,secondaryColor]},labels:{lineWidth:0.3,fontSize:11,x:{number:7,show:true,color:"#858585",grid:false},y:{number:4,show:true,color:"#858585",grid:true}}};var a=window.devicePixelRatio||1;function f(i,k){console.log(i+":");console.log(k);console.log("---")}h.graphers=function(B,A,D){var q=d.createCanvas(A.width,A.height);var o=q.getContext("2d");var E=q.width;var C=q.height;var s=20;if(A.labels.x.show){}var w=d.getYValues(B,A.y,A.goal);var z=d.getXValues(B,A.x);z.marginLeft=0;var l=C-s;if(A.labels.y.show){number=A.labels.y.number;var m=l/number;range=w.marginMax-w.marginMin;add=range/number;w.labels=[];o.fillStyle=A.labels.y.color;o.lineStyle=A.labels.y.color;o.strokeStyle="#D2D2D2";o.font=A.labels.fontSize+"px"+g(this).css("font-family");var u=0;for(var F=0;F<number;F++){v={y:l-m*F,value:(w.marginMin+(add*F)).toFixed(2)};w.labels.push(v);o.fillText(v.value,1,v.y+3);if(F==0){u=v.value.length}else{u=Math.max(v.value.length,u)}}z.marginLeft=z.margin+u*(A.labels.fontSize/2);if(A.labels.y.grid){for(var F=0;F<w.labels.length;F++){v=w.labels[F].y;o.beginPath();o.lineWidth=A.labels.lineWidth;o.moveTo(z.marginLeft,v);o.lineTo(E,v);o.closePath();o.stroke()}}}if(A.labels.x.show){number=B.length;G=A.labels.x.number;days=d.deltaDays(z.min,z.max);if(days<=G){skip=1}else{skip=((days/G)).toFixed()}var H=(E-z.marginLeft-z.margin)/days;range=z.max-z.min;add=range/days;z.labels=[];o.fillStyle=A.labels.y.color;o.lineStyle=A.labels.y.color;o.strokeStyle="#D2D2D2";o.font=A.labels.fontSize+"px"+g(this).css("font-family");for(var F=0;F<days;F++){if(F%skip==0){v={x:H*F,value:parseInt((z.min+(add*F)))};z.labels.push(v);o.textAlign="center";o.fillText(d.fDate(new Date(v.value)),z.marginLeft+v.x,C-4);if(A.labels.x.grid){o.beginPath();o.lineWidth=A.labels.lineWidth;o.moveTo(z.marginLeft+v.x,l+5);o.lineTo(z.marginLeft+v.x,s);o.closePath();o.stroke()}}}}z.quotient=(E-(z.margin+z.marginLeft))/(z.max-z.min);w.quotient=(l)/(w.marginMax-w.marginMin);var k=[];var F;for(F=0;F<B.length;F++){var I=B[F].data;k[F]=[];for(j=0;j<I.length;j++){var G=I[j];var t=d.getTime(G.date);var p=((t-z.min)*z.quotient)+z.marginLeft;var n=l-(w.quotient*(G.value-w.marginMin));k[F].push({x:p,y:n,date:t,value:G.value})}}for(c=k.length-1;c>=0;c--){coords=k[c];if(coords.length>0){if(A.lines.fill){o.beginPath();o.moveTo(coords[0].x,l);o.lineTo(coords[0].x,coords[0].y);o.globalAlpha=A.lines.fillOpacity;for(F=0;F<coords.length-1;F++){d.line(o,coords[F],coords[F+1],A.lines.curve)}o.fillStyle=A.lines.fillColor[c];o.lineTo(coords[coords.length-1].x,l);o.closePath();o.fill()}o.globalAlpha=1;if(A.lines.show){o.beginPath();o.moveTo(coords[0].x,coords[0].y);for(F=0;F<coords.length-1;F++){d.line(o,coords[F],coords[F+1],A.lines.curve)}o.lineWidth=A.lines.strokeWidth*a;o.strokeStyle=A.lines.strokeColor[c];o.stroke()}if(A.points.show){for(F=0;F<coords.length;F++){var r=coords[F];o.beginPath();o.arc(r.x,r.y,A.points.strokeWidth,0,2*Math.PI);o.fillStyle=A.points.strokeColor[c]||A.lines.strokeColor[c];
o.fill();o.strokeStyle=A.points.strokeColor[c]||A.lines.strokeColor[c];o.stroke()}}}}if(A.goal.show){var n=l-(w.quotient*(A.goal.value-w.marginMin));o.beginPath();o.moveTo(z.marginLeft,n);o.lineTo(E,n);o.fillStyle=A.points.strokeColor||A.lines.strokeColor;o.lineWidth=2;o.fill();o.strokeStyle=A.goal.color||A.lines.strokeColor[0];o.stroke()}if(A.tooltip.show){q.addEventListener(d.tooltipEvent(),function(y){var i={};if(y.pageX||y.pageY){i.x=y.pageX;i.y=y.pageY}else{i.x=y.clientX+b.body.scrollLeft+b.documentElement.scrollLeft;i.y=y.clientY+b.body.scrollTop+b.documentElement.scrollTop}i.x-=q.offsetLeft;i.y-=q.offsetTop;var x=true;for(c=0;c<k.length;c++){for(F=0;F<k[c].length;F++){point=k[c][F];if((Math.abs(point.x-i.x)<A.points.strokeWidth*A.tooltip.maxRadius)&(Math.abs(point.y-i.y)<A.points.strokeWidth*A.tooltip.maxRadius)){x=false;D({found:true,point:point,mouse:y})}}}if(x){D({found:false})}},false)}g(this).append(q)}})($,document);