!function(t,o){var a=t.fn.pista=function(e,i,l){return o.createElement("canvas").getContext&&this.each(function(){opts=t.extend(!0,{},a.defaults,i),a.graphers.call(this,e,opts,l)}),this},i={getTime:function(e){return new Date(e).getTime()},tooltipEvent:function(){return"mousemove"},createCanvas:function(e,t){var a=o.createElement("canvas");if(a.setAttribute("width",e*l),a.setAttribute("height",t*l),1!=l){var i="width:"+e+"px;height:"+t+"px";a.setAttribute("style",i)}return a},getYValues:function(t,o,a){for(var i={},l=0;l<t.length;l++)for(var n=t[l].data,r=0;r<n.length;r++)e=n[r].value,0==l&0==r?i.min=i.max=e:(i.min=Math.min(i.min,e),i.max=Math.max(i.max,e));return o.max&&(i.max=o.max),o.min&&(i.min=o.min),a.show&&(i.max=Math.max(i.max,a.value),i.min=Math.min(i.min,a.value)),i.marginMin=i.min-i.min*o.margin,i.marginMax=i.max+i.max*o.margin,i.margin=(i.marginMax-i.marginMin)*o.margin,i},getXValues:function(e,t){for(var o={},a=0;a<e.length;a++){var l=e[a].data;0==a?(o.max=i.getTime(l[l.length-1].date),o.min=i.getTime(l[0].date)):(o.max=Math.max(o.max,i.getTime(l[l.length-1].date)),o.min=Math.min(o.min,i.getTime(l[0].date)))}return t.max&&(o.max=i.getTime(t.max)),t.min&&(o.min=i.getTime(t.min)),o.margin=t.margin,o},line:function(e,t,o,a){if(a){var i={x:(t.x+o.x)/2,y:(t.y+o.y)/2};e.quadraticCurveTo((t.x+i.x)/2,t.y,i.x,i.y),e.quadraticCurveTo((i.x+o.x)/2,o.y,o.x,o.y)}else e.lineTo(o.x,o.y)},fDate:function(e){return e.getMonth()+1+"/"+e.getDate()},deltaDays:function(e,t){var o=864e5;return Math.round(Math.abs((e-t)/o))}};mainColor="#3BAFD7",secondaryColor="#E1523D",a.defaults={height:100,width:100,x:{margin:15,min:null,max:null},y:{margin:.2,min:null,max:null},goal:{show:!1,value:23,color:mainColor},tooltip:{show:!0,maxRadius:3},lines:{show:!0,fill:!1,curve:!1,strokeColor:[mainColor,secondaryColor],strokeWidth:4,fillOpacity:.4,fillColor:[mainColor,secondaryColor]},points:{show:!0,strokeWidth:3.5,strokeColor:[mainColor,secondaryColor]},labels:{lineWidth:.3,fontSize:11,x:{number:7,show:!0,color:"#858585",grid:!1},y:{number:4,show:!0,color:"#858585",grid:!0}}};var l=window.devicePixelRatio||1;a.graphers=function(e,a,n){var r=i.createCanvas(a.width,a.height),s=r.getContext("2d"),m=r.width,g=r.height,h=20;a.labels.x.show;var d=i.getYValues(e,a.y,a.goal),f=i.getXValues(e,a.x);f.marginLeft=0;var u=g-h;if(a.labels.y.show){number=a.labels.y.number;var x=u/number;range=d.marginMax-d.marginMin,add=range/number,d.labels=[],s.fillStyle=a.labels.y.color,s.lineStyle=a.labels.y.color,s.strokeStyle="#D2D2D2",s.font=a.labels.fontSize+"px"+t(this).css("font-family");for(var y=0,b=0;b<number;b++)v={y:u-x*b,value:(d.marginMin+add*b).toFixed(2)},d.labels.push(v),s.fillText(v.value,1,v.y+3),y=0==b?v.value.length:Math.max(v.value.length,y);if(f.marginLeft=f.margin+y*(a.labels.fontSize/2),a.labels.y.grid)for(var b=0;b<d.labels.length;b++)v=d.labels[b].y,s.beginPath(),s.lineWidth=a.labels.lineWidth,s.moveTo(f.marginLeft,v),s.lineTo(m,v),s.closePath(),s.stroke()}if(a.labels.x.show){number=e.length,T=a.labels.x.number,days=i.deltaDays(f.min,f.max),skip=days<=T?1:(days/T).toFixed();var p=(m-f.marginLeft-f.margin)/days;range=f.max-f.min,add=range/days,f.labels=[],s.fillStyle=a.labels.y.color,s.lineStyle=a.labels.y.color,s.strokeStyle="#D2D2D2",s.font=a.labels.fontSize+"px"+t(this).css("font-family");for(var b=0;b<days;b++)b%skip==0&&(v={x:p*b,value:parseInt(f.min+add*b)},f.labels.push(v),s.textAlign="center",s.fillText(i.fDate(new Date(v.value)),f.marginLeft+v.x,g-4),a.labels.x.grid&&(s.beginPath(),s.lineWidth=a.labels.lineWidth,s.moveTo(f.marginLeft+v.x,u+5),s.lineTo(f.marginLeft+v.x,h),s.closePath(),s.stroke()))}f.quotient=(m-(f.margin+f.marginLeft))/(f.max-f.min),d.quotient=u/(d.marginMax-d.marginMin);var b,k=[];for(b=0;b<e.length;b++){var C=e[b].data;for(k[b]=[],j=0;j<C.length;j++){var T=C[j],M=i.getTime(T.date),w=(M-f.min)*f.quotient+f.marginLeft,S=u-d.quotient*(T.value-d.marginMin);k[b].push({x:w,y:S,date:M,value:T.value})}}for(c=k.length-1;c>=0;c--)if(coords=k[c],coords.length>0){if(a.lines.fill){for(s.beginPath(),s.moveTo(coords[0].x,u),s.lineTo(coords[0].x,coords[0].y),s.globalAlpha=a.lines.fillOpacity,b=0;b<coords.length-1;b++)i.line(s,coords[b],coords[b+1],a.lines.curve);s.fillStyle=a.lines.fillColor[c],s.lineTo(coords[coords.length-1].x,u),s.closePath(),s.fill()}if(s.globalAlpha=1,a.lines.show){for(s.beginPath(),s.moveTo(coords[0].x,coords[0].y),b=0;b<coords.length-1;b++)i.line(s,coords[b],coords[b+1],a.lines.curve);s.lineWidth=a.lines.strokeWidth*l,s.strokeStyle=a.lines.strokeColor[c],s.stroke()}if(a.points.show)for(b=0;b<coords.length;b++){var D=coords[b];s.beginPath(),s.arc(D.x,D.y,a.points.strokeWidth,0,2*Math.PI),s.fillStyle=a.points.strokeColor[c]||a.lines.strokeColor[c],s.fill(),s.strokeStyle=a.points.strokeColor[c]||a.lines.strokeColor[c],s.stroke()}}if(a.goal.show){var S=u-d.quotient*(a.goal.value-d.marginMin);s.beginPath(),s.moveTo(f.marginLeft,S),s.lineTo(m,S),s.fillStyle=a.points.strokeColor||a.lines.strokeColor,s.lineWidth=2,s.fill(),s.strokeStyle=a.goal.color||a.lines.strokeColor[0],s.stroke()}a.tooltip.show&&r.addEventListener(i.tooltipEvent(),function(e){var t={};e.pageX||e.pageY?(t.x=e.pageX,t.y=e.pageY):(t.x=e.clientX+o.body.scrollLeft+o.documentElement.scrollLeft,t.y=e.clientY+o.body.scrollTop+o.documentElement.scrollTop),t.x-=r.offsetLeft,t.y-=r.offsetTop;var i=!0;for(c=0;c<k.length;c++)for(b=0;b<k[c].length;b++)point=k[c][b],Math.abs(point.x-t.x)<a.points.strokeWidth*a.tooltip.maxRadius&Math.abs(point.y-t.y)<a.points.strokeWidth*a.tooltip.maxRadius&&(i=!1,n&&n({found:!0,point:point,mouse:e}));i&&n&&n({found:!1})},!1),t(this).append(r)}}($,document);